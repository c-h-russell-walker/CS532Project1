<!DOCTYPE HTML> 
<html>
    <head>
    <title>Hwk 1</title>
    <link rel="stylesheet" href="stick.css" type="text/css"/>
    <!-- <script src="http://www.html5canvastutorials.com/libraries/kinetic2d-v1.0.2.js"></script> -->
    <script src="kinetic2d-v1.0.2.js"></script>
    <!--
    Chris Russell-Walker
    c.russell.walker@gmail.com
    BU CS532 Comp Graphics
    Project 1
    -->
    <script>
        var kin;
        var figure;
        var armAngle = 10;
        var legAngle = -30;
        var stroke = false;

        var bodyX = 0;
        var bodyY = 40;
        var headSize = 50;
        var bodyHeight = 200;
        var legLength = 120;
        var armLength = 80;

        var footPos = 5;
        var armPos = 4;
        var legBend = false;
        var armBend = false;
        var floorHeight = 50;
        var oscillate = false;
        var swivel = -1;
        var jumpJackArms = false;

        function init() {
            canvas = document.getElementById("stickScene");
            context = canvas.getContext("2d");
            floorHeight = canvas.height / 2;
            document.addEventListener('mousedown', mouseClickHandler, false);
            kin = new Kinetic_2d("stickScene");
            kin.setDrawStage(function () {
                kin.clear();
                var context = kin.getContext();
                context.lineWidth = "4";
                drawWaves();
                run();
            });
        }
        
        function drawWaves() {
            context.save();
            context.moveTo(0, floorHeight);
            // sine path from 0 to rads radians scales by sx
            context.translate(-kin.frame *2, 0);
            var N = canvas.width;
            var dx=2*(Math.PI)/N;
            var x=0;
            var px = 0;
            var py = floorHeight;
            
            context.beginPath();
            context.strokeStyle = "Blue";
           
            for (var i=0;i<N*4;i++)
            {
                x += dx;
                y = Math.sin(x);
    
                px += (180.0/(Math.PI))*dx;
                py = - 30*y;
    
                context.lineTo(px-kin.frame, py + floorHeight);
            }
            context.stroke();
            context.restore();
        }

        function mouseClickHandler(event) {
            mouseX = event.clientX;
            mouseY = event.clientY;
            kin.startAnimation();
        }

        function cartesianToPolar(x, y) {
            var length = Math.sqrt((x * x) + (y * y));
            var angle = Math.atan(y / x);
            var polarCrds = new Array(length, angle);
            return polarCrds;
        }

        function polarToCartesian(length, theta) {
            var x = Math.cos(theta)*length;
            var y = Math.sin(theta) * length;
            return (length, theta);
        }

        function run() {
            
            context.fillText(kin.frame.toString(), 10, 10);

            figure = new stickFigure();
            
            if (kin.frame != 0 && kin.frame < 400) {
                //if (legAngle >= -60 && legAngle < )
                if (stroke)
                    legAngle = -kin.frame % 65;
                if (!stroke)
                    legAngle = legAngle + 1;
                if (kin.frame % 65 == 0)
                    stroke = !stroke;
                if (legAngle == 0)
                    stroke = !stroke;
                
                armAngle = kin.frame;
            }
            if (kin.frame >= 400) {
                kin.frame = 1;
            }
            figure.draw();
            
            /*
            if (kin.frame != 0 && kin.frame < 300) {
                if (kin.frame % 6 == 0) {
                    jumpingJacks();
                }
                switch (kin.frame%20) {
                case 0,1,2,3,4,5,6,7,8,9:
                    floorHeight = floorHeight + 4;
                    armBend = false;
                    footPos = 4;
                    jumpJackArms = false;
                    break;
                case 10,11,12,13,14,15,16,17,18,19:
                    floorHeight = floorHeight - 4;
                    armBend = true;
                    jumpJackArms = true;
                    footPos = 5;
                    break;
                }
                drawFigure();
                armBend = false;
            }
            if (kin.frame >= 300 && kin.frame < 850) {
                jumpJackArms = false;
                if (kin.frame % 6 == 0) {
                    footPos = 5.5;
                    guyWalks();
                }
                if (kin.frame >= 450 && kin.frame < 550) {
                    floorHeight = floorHeight - 1;
                }
                if (kin.frame >= 550 && kin.frame < 650) {
                    floorHeight = floorHeight + 1;
                    jumpJackArms = true;
                    switch (kin.frame%20) {
                        case 0,1,2,3,4,5,6,7,8,9:
                            jumpJackArms = true;
                            break;
                    }
                }
                drawFigure();
            }
            if (kin.frame >= 850) {
                kin.stopAnimation();
                drawFigure();
                kin.frame = 0;
            } else if (kin.frame == 0) {
                drawFigure();
            }
            */
            //context.restore();
        }
        /**** Stick Figure Objects ****/
        function stickFigure() {
            this.body = new body(bodyX, bodyY, bodyHeight);
            this.head = new head(bodyX, bodyY, headSize);
            this.leftArm = new arm(bodyX, bodyHeight / 2.6, -armLength, true);
            this.rightArm = new arm(bodyX, bodyHeight / 2.6, armLength, false);
            this.leftLeg = new leg(bodyX, bodyHeight, -legLength);
            this.rightLeg = new leg(bodyX, bodyHeight, legLength);
            this.draw = drawFigure;
        }
        function body(x, y, length) {
            this.draw = drawBody;
            this.x = x;
            this.y = y;
            this.length = length;
        }
        function head(x, y, radius) {
            this.draw = drawHead;
            this.x = x;
            // Puts 'neck' (bottom of circle) at top of body
            this.y = y - radius;
            this.radius = radius;
        }
        function arm(x, y, armLength, left) {
            this.x = x;
            this.y = y;
            this.length = armLength / 2;
            this.left = left;
            this.bicep = new bicep(this.x, this.y, this.length);
            this.forearm = new forearm(this.x + Math.abs(this.length), this.y, this.length);
            /*if (left) {
                this.forearm = new forearm(-this.x + this.length, this.y, this.length);
            } else
                this.forearm = new forearm(this.x + this.length, this.y, this.length);*/
        }
        function leg(x, y, legLength) {
            this.x = x;
            this.y = y;
            this.length = legLength / 2;
            this.thigh = new thigh(this.x, this.y, this.length);
            this.calf = new calf(this.x + Math.abs(length), this.y + length, this.length);
        }
        function bicep(x, y, length) {
            this.draw = drawBicep;
            this.x = x;
            this.y = y;
            this.length = length;
        }
        function forearm(x, y, length) {
            this.draw = drawForearm;
            this.x = x;
            this.y = y;
            this.length = length;
        }
        function thigh(x, y, length) {
            this.draw = drawThigh;
            this.x = x;
            this.y = y;
            this.length = length;
        }
        function calf(x, y, length) {
            this.draw = drawCalf;
            this.x = x;
            this.y = y;
            this.length = length;
        }

        /**** START FIGURE DRAWING ****/
        function drawFigure() {
            context.save(); // State 1
            context.translate(canvas.width / 2, floorHeight);
            context.rotate(Math.PI/2)
            this.body.draw();
            this.head.draw();
            
            context.save(); // State 2.1
            //LEFT ARM translate, etc
            context.translate(0, bodyHeight / 2.6);
            context.rotate(Math.PI / 180 * armAngle);
            this.leftArm.bicep.draw();
            this.leftArm.forearm.draw(armAngle/2);
            //context.restore(); // State 2.1
            
            //context.save(); // State 2.2
            // RIGHT ARM translate etc
            //context.translate(0, bodyHeight / 2.6);
            armAngle = -armAngle;
            
            context.rotate(Math.PI / 180 * -armAngle);
            this.rightArm.bicep.draw();
            this.rightArm.forearm.draw(armAngle/2);
            context.restore(); // State 2.2
            
            context.save(); // State 3.1
            // LEFT LEG translate, etc
            context.translate(0, bodyHeight);
            context.rotate(Math.PI / 180 * legAngle);
            this.leftLeg.thigh.draw();
            this.leftLeg.calf.draw(legAngle/2);
            context.restore(); // State 3.1

            context.save(); // State 3.2
            // RIGHT LEG translate, etc
            context.translate(0, bodyHeight);
            context.rotate(Math.PI / 180 * -legAngle);
            this.rightLeg.thigh.draw();
            this.rightLeg.calf.draw(-legAngle/2);
            context.restore(); // State 3.2

            context.restore(); // State 1
        }
        function drawBody() {
            context.save();
            context.moveTo(this.x, this.y);
            context.strokeStyle = "Grey";
            context.lineTo(this.x, this.length);
            context.stroke();
            context.restore();
        }
        function drawHead() {
            context.save();
            kin.beginRegion();
            context.beginPath();
            context.fillStyle = "Blue";
            kin.addRegionEventListener("mouseover", function () { context.fillStyle = "Red"; });
            kin.addRegionEventListener("mouseout", function () { oscillate = false; });
            // x, y, radius, start-angle, end-angle
            context.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
            //context.fill();
            context.closePath();
            context.stroke();
            kin.closeRegion();
            context.restore();
        }
        function drawBicep() {
            context.moveTo(0, 0);
            //context.arc(0, 0, 3, 0, 2 * Math.PI);
            //var polarCrds = cartesianToPolar(this.length, this.angle);
            //context.lineTo(polarCrds[0], polarCrds[1]);
            context.lineTo(this.length, 0);
            context.stroke();
            //context.restore();
        }
        function drawForearm(angle) {
            context.save();
            this.angle = angle;
            context.translate(this.length, 0);
            context.rotate(Math.PI / 180 * this.angle);
            //context.moveTo(this.length, 0);
            context.lineTo(this.length, 0);
            //var polarCrds = cartesianToPolar(-2*this.length, this.angle);
            //context.lineTo(polarCrds[0], polarCrds[1]);
            context.stroke();
            context.restore();
        }
        function drawThigh() {
            context.moveTo(0, 0);
            //context.arc(0, 0, 3, 0, 2 * Math.PI);
            context.lineTo(this.length, 0);
            context.stroke();
        }
        function drawCalf(angle) {
            context.save();
            this.angle = angle;
            context.translate(this.length, 0);
            context.rotate(Math.PI / 180 * this.angle);
            context.lineTo(this.length, 0);
            context.stroke();
            context.restore();
        }
        function drawLegXXX() {
            //context.save();
            context.moveTo(this.x, this.y);
            context.lineTo(this.length, this.y);
            //context.rotate(Math.PI / (footPos * swivel));
            context.stroke();
            //context.restore();
        }
        function drawFigureXXX() {
            drawBody();
            drawHead();
            drawLeg(1);
            drawLeg(swivel); // left swivel = -1
            if (!jumpJackArms) {
                drawArm(1);
                drawArm(swivel); // left swivel = -1
            } else {
                drawBentArms();
            }
            context.restore();
            context.save();
        }
        function drawArmXXX(swivel) {
            context.save();
            context.translate(0, 0);
            context.moveTo(bodyCenterX, -bodyCenterY);
            context.rotate(Math.PI / (armPos * swivel));
            if (armBend) {
                context.lineTo((swivel * armLength) / 1.5, (-bodyCenterY / 2)+1);
                if (swivel == -1)
                    context.rotate(Math.PI/(armPos * swivel));
                drawHand(swivel * armLength);
            } else {
                context.lineTo(swivel * armLength, -bodyCenterY / 2);
            }
            context.stroke();
            context.restore();
        }
        function drawHandxxx(handLength) {
            // x, y, width, height
            context.fillRect((handLength / 1.5), (-bodyCenterY / 2), 2, (swivel * armLength/2));
        }
        function drawBentArmsxxx() {
            context.save();
            context.translate(0, 0);
            context.moveTo(bodyCenterX, -bodyCenterY);
            context.rotate(Math.PI / (armPos * swivel));
            context.lineTo((swivel * armLength) / 1.5, -bodyCenterY / 2);
            drawHand(swivel * armLength);
            context.stroke();
            context.restore();
            context.save();
            context.translate(0, 0);
            context.moveTo(bodyCenterX, -bodyCenterY);
            context.rotate(Math.PI / (armPos * -swivel));
            context.lineTo(-(swivel * armLength) / 1.5, -bodyCenterY / 2);
            drawHand(-swivel * armLength);
            context.stroke();
            context.restore();
        }
        function drawLegXXX(swivel) {
            context.save();
            context.translate(0, 0);
            context.moveTo(bodyCenterX, bodyHeight);
            context.rotate(Math.PI / (footPos * swivel));
            if (legBend) {
                context.save();
                context.lineTo((swivel * legLength) / 1.5, bodyHeight);
                context.stroke();
                context.restore();
                drawFoot(swivel);
            } else {
                context.lineTo(swivel * legLength, bodyHeight);
            }
            context.stroke();
            context.restore();
        }
        function drawFootxxx(swivel) {
            context.save();
            context.translate(0, 0);
            //context.rotate((Math.PI) / 0.666);
            //context.lineTo((swivel * legLength), legLength / 333);
            context.fillRect((swivel * legLength) / 1.5, bodyHeight, 2, 30*swivel);
            context.stroke();
            context.restore();
        }
        /**** END FIGURE DRAWING ****/

        function jumpingJacks() {
            jumpingJacksArms(75);
            jumpingJacksLegs(75);
        }
        function jumpingJacksArms(speed) {
            // left
            
            // right
        }
        function jumpingJacksLegs(speed) {
            // left
            
            // right
        }
        function guyWalks() {
            legBend = !legBend;
            armBend = !armBend;
        }

        window.onload = function () {
            init();
        };
        </script> 
    </head> 
    <body onmousedown="return false;">
        <canvas id="stickScene" width="960" height="640"></canvas> 
    </body>
</html>